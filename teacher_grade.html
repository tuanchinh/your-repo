<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Ch·∫•m b√†i h·ªçc sinh</title>
<style>
body{font-family:Arial;background:#f4f6f9;margin:0}
header{background:#198754;color:white;padding:15px;font-size:20px}
.container{width:95%;margin:auto;margin-top:20px}
.card{background:white;padding:15px;border-radius:8px;margin-bottom:15px}
table{width:100%;border-collapse:collapse}
th,td{border:1px solid #ccc;padding:8px}
th{background:#198754;color:white}
textarea{width:100%;height:100px}
input[type=number]{width:80px}
button{padding:6px 12px;border:none;border-radius:5px;background:#198754;color:white;cursor:pointer}
button:hover{background:#146c43}
.pending{color:red;font-weight:bold}
.done{color:green;font-weight:bold}
</style>
</head>
<body>

<header>üßë‚Äçüè´ CH·∫§M B√ÄI H·ªåC SINH</header>

<div class="container">

<div class="card">
  <h3>üìã Danh s√°ch b√†i n·ªôp</h3>
  <table>
    <tr>
      <th>H·ªçc sinh</th>
      <th>L·ªõp</th>
      <th>B√†i</th>
      <th>Tr·∫°ng th√°i</th>
      <th>Thao t√°c</th>
    </tr>
    <tbody id="submissionList"></tbody>
  </table>
</div>

<div class="card" id="gradeBox" style="display:none">
  <h3>‚úçÔ∏è Ch·∫•m b√†i</h3>
  <p><strong>H·ªçc sinh:</strong> <span id="sName"></span></p>
  <p><strong>B√†i:</strong> <span id="sExam"></span></p>

  <h4>B√†i l√†m:</h4>
  <pre id="sAnswer" style="background:#f1f1f1;padding:10px"></pre>

  <label>ƒêi·ªÉm:</label>
  <input type="number" id="score" min="0" max="10" step="0.25">

  <label>Nh·∫≠n x√©t:</label>
  <textarea id="note"></textarea>

  <br><br>
  <button onclick="saveGrade()">üíæ L∆∞u ƒëi·ªÉm</button>
</div>

</div>

<script>
let submissions = JSON.parse(localStorage.getItem("offline_submissions")) || [];
let currentIndex = -1;

// ============================
// LOAD DANH S√ÅCH
// ============================
function loadList(){
    const tbody=document.getElementById("submissionList");
    tbody.innerHTML="";

    if(submissions.length===0){
        tbody.innerHTML=`<tr><td colspan="5">Ch∆∞a c√≥ b√†i n·ªôp</td></tr>`;
        return;
    }

    submissions.forEach((s,i)=>{
        tbody.innerHTML+=`
        <tr>
          <td>${s.username}</td>
          <td>${s.grade}</td>
          <td>${s.examTitle}</td>
          <td class="${s.score==null?'pending':'done'}">
            ${s.score==null?'Ch∆∞a ch·∫•m':'ƒê√£ ch·∫•m'}
          </td>
          <td>
            <button onclick="openGrade(${i})">Ch·∫•m</button>
          </td>
        </tr>
        `;
    });
}

// ============================
// M·ªû B√ÄI
// ============================
function openGrade(i){
    currentIndex=i;
    const s=submissions[i];

    document.getElementById("gradeBox").style.display="block";
    document.getElementById("sName").innerText=s.username;
    document.getElementById("sExam").innerText=s.examTitle;
    document.getElementById("sAnswer").innerText=s.answers || "(Kh√¥ng c√≥ n·ªôi dung)";
    document.getElementById("score").value=s.score ?? "";
    document.getElementById("note").value=s.teacherNote ?? "";
}

// ============================
// L∆ØU ƒêI·ªÇM
// ============================
function saveGrade(){
    if(currentIndex<0) return;

    submissions[currentIndex].score =
        document.getElementById("score").value;
    submissions[currentIndex].teacherNote =
        document.getElementById("note").value;

    localStorage.setItem("offline_submissions",JSON.stringify(submissions));
    alert("‚úÖ ƒê√£ l∆∞u ƒëi·ªÉm");
    loadList();
}

loadList();
</script>

</body>
</html>