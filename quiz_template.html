<button onclick="submitExam()">üì§ N·ªôp b√†i</button>
<div id="submitMsg"></div>

<script>
async function submitExam() {
    if (!confirm("B·∫°n ch·∫Øc ch·∫Øn mu·ªën n·ªôp b√†i?")) return;

    const payload = {
        username: localStorage.getItem("username"),
        class: localStorage.getItem("class"),
        examFile: localStorage.getItem("current_exam"),
        answers: collectAnswers()
    };

    try {
        const res = await fetch("http://localhost:3000/api/submit", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!res.ok) {
            throw new Error(data.error || "N·ªôp b√†i th·∫•t b·∫°i");
        }

        document.getElementById("submitMsg").innerHTML = `
            <div style="color:green;font-weight:bold">
                ‚úÖ N·ªôp b√†i th√†nh c√¥ng!
            </div>
        `;

        // Kho√° b√†i
        document.querySelectorAll("input, button").forEach(e => e.disabled = true);

    } catch (err) {
        document.getElementById("submitMsg").innerHTML = `
            <div style="color:red">
                ‚ùå ${err.message}
            </div>
        `;
    }
}
</script>