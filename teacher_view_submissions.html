<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Gi√°o vi√™n ch·∫•m b√†i</title>
<style>
body{
  font-family: Arial, sans-serif;
  background:#f4f6f9;
  margin:0;
  padding:20px;
}
h1{ text-align:center; }
.card{
  background:#fff;
  padding:15px;
  margin:15px auto;
  max-width:900px;
  border-radius:8px;
  box-shadow:0 3px 6px rgba(0,0,0,.1);
}
.question{
  border-left:4px solid #3498db;
  padding:10px;
  margin:10px 0;
  background:#fafafa;
}
textarea{
  width:100%;
  min-height:80px;
}
button{
  padding:6px 12px;
  margin:5px;
  cursor:pointer;
}
.score{
  font-weight:bold;
  color:#27ae60;
}
.pending{
  color:#e67e22;
}
</style>
</head>
<body>

<h1>üìò Gi√°o vi√™n ch·∫•m b√†i</h1>

<div id="list"></div>

<script>
const API = "http://localhost:3000";

/* ===========================
   LOAD DANH S√ÅCH B√ÄI L√ÄM
=========================== */
async function loadSubmissions(){
  const res = await fetch(`${API}/submissions.json`);
  const submissions = await res.json();
  render(submissions);
}

/* ===========================
   HI·ªÇN TH·ªä
=========================== */
function render(data){
  const list = document.getElementById("list");
  list.innerHTML = "";

  data.forEach((sub, idx)=>{
    const div = document.createElement("div");
    div.className="card";

    div.innerHTML = `
      <h3>üë®‚Äçüéì HS: ${sub.studentId} ‚Äì L·ªõp ${sub.class}</h3>
      <p>üìù M√£ ƒë·ªÅ: ${sub.examCode}</p>
      <p>‚è± ${new Date(sub.submittedAt).toLocaleString()}</p>
      <p class="score">ƒêi·ªÉm tr·∫Øc nghi·ªám: ${sub.scoreAuto || 0}</p>
    `;

    sub.answers.forEach((a,i)=>{
      const qDiv = document.createElement("div");
      qDiv.className="question";

      if(a.type==="mcq"){
        qDiv.innerHTML = `
          <b>C√¢u ${i+1} (Tr·∫Øc nghi·ªám)</b><br>
          HS ch·ªçn: ${a.answer || "‚ùå"} | ƒê√°p √°n: ${a.correct}
        `;
      }

      if(a.type==="essay"){
        qDiv.innerHTML = `
          <b>C√¢u ${i+1} (T·ª± lu·∫≠n)</b><br>
          <i>B√†i l√†m:</i>
          <textarea disabled>${a.answer}</textarea>
          <p class="pending" id="status-${idx}-${i}">
            ‚è≥ Ch∆∞a ch·∫•m
          </p>
          <button onclick="aiGrade(${idx},${i})">ü§ñ AI ch·∫•m</button>
          <input id="score-${idx}-${i}" type="number" min="0" max="10" step="0.25" placeholder="ƒêi·ªÉm GV">
        `;
      }

      div.appendChild(qDiv);
    });

    list.appendChild(div);
  });
}

/* ===========================
   AI CH·∫§M T·ª∞ LU·∫¨N
=========================== */
async function aiGrade(subIdx, ansIdx){
  const res = await fetch(`${API}/submissions.json`);
  const subs = await res.json();
  const ans = subs[subIdx].answers[ansIdx];

  const payload = {
    question: "C√¢u h·ªèi t·ª± lu·∫≠n",
    answer: ans.answer,
    rubric: "Ch·∫•m ƒë√∫ng ki·∫øn th·ª©c, l·∫≠p lu·∫≠n r√µ r√†ng",
    maxPoint: 10
  };

  const r = await fetch(`${API}/grade-essay`,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify(payload)
  });

  const result = await r.json();

  document.getElementById(`status-${subIdx}-${ansIdx}`).innerHTML =
    `‚úÖ AI: ${result.score}ƒë ‚Äì ${result.comment}`;

  document.getElementById(`score-${subIdx}-${ansIdx}`).value =
    result.score;
}

loadSubmissions();
</script>
</body>
</html>