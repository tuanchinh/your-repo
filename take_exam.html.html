<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>LÃ m bÃ i kiá»ƒm tra</title>
<style>
body{font-family:Arial;background:#f4f6fb;padding:20px;}
.question{background:#fff;padding:10px;margin-bottom:10px;border-radius:6px;}
button{padding:8px 12px;border:none;background:#0b5ed7;color:white;border-radius:5px;}
.status{margin-bottom:10px;font-weight:bold;}
.offline{color:red;}
.online{color:green;}
</style>
</head>
<body>

<h2>ğŸ“ LÃ m bÃ i kiá»ƒm tra</h2>
<div id="netStatus" class="status"></div>

<div id="questions"></div>

<button onclick="submitExam()">ğŸ“¤ Ná»™p bÃ i</button>

<script>
// ==========================
// KIá»‚M TRA ÄÄ‚NG NHáº¬P
// ==========================
const student = JSON.parse(localStorage.getItem("currentStudent"));
if(!student) location.href="login.html";

const exams = JSON.parse(localStorage.getItem("exams_grade"+student.grade)) || [];
const index = localStorage.getItem("currentExamIndex");
const exam = exams[index];

// ==========================
// HIá»‚N THá»Š CÃ‚U Há»I
// ==========================
const qDiv = document.getElementById("questions");
exam.questions.forEach((q,i)=>{
    qDiv.innerHTML += `
      <div class="question">
        <strong>CÃ¢u ${i+1}:</strong> ${q}<br>
        <input type="text" id="ans_${i}" placeholder="Nháº­p Ä‘Ã¡p Ã¡n">
      </div>
    `;
});

// ==========================
// KIá»‚M TRA Máº NG
// ==========================
function updateStatus(){
    const status = navigator.onLine
      ? "<span class='online'>ğŸŸ¢ CÃ³ máº¡ng</span>"
      : "<span class='offline'>ğŸ”´ Äang offline</span>";
    document.getElementById("netStatus").innerHTML = status;
}
window.addEventListener("online",updateStatus);
window.addEventListener("offline",updateStatus);
updateStatus();

// ==========================
// Ná»˜P BÃ€I
// ==========================
function submitExam(){
    const answers = {};
    exam.questions.forEach((_,i)=>{
        answers[i] = document.getElementById("ans_"+i).value;
    });

    const submission = {
        username: student.username,
        grade: student.grade,
        examTitle: exam.title,
        answers,
        time: new Date().toLocaleString(),
        synced: false
    };

    let offline = JSON.parse(localStorage.getItem("offline_submissions")) || [];
    offline.push(submission);
    localStorage.setItem("offline_submissions",JSON.stringify(offline));

    alert(navigator.onLine
        ? "ÄÃ£ ná»™p bÃ i!"
        : "Máº¥t máº¡ng â€“ bÃ i Ä‘Ã£ lÆ°u, sáº½ tá»± ná»™p khi cÃ³ máº¡ng");

    location.href="student_dashboard.html";
}
</script>
</body>
</html>