
<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Qu·∫£n l√Ω l·ªõp 6</title>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
body{font-family:Arial;background:#eef2f3;margin:0}
header{background:#005f99;color:white;padding:15px;font-size:24px;text-align:center}
.container{width:90%;margin:auto;margin-top:20px}
table{width:100%;border-collapse:collapse;background:white}
th,td{border:1px solid #ccc;padding:8px}
th{background:#005f99;color:white}
button{padding:6px 12px;border:none;border-radius:4px;cursor:pointer}
.delete-btn{background:#d00000;color:white}
.add-btn{background:#2b9348;color:white}
.back-btn{background:#6c757d;color:white}
.box{background:white;padding:15px;margin-top:20px;border-radius:6px;box-shadow:0 0 5px #bbb}
input{padding:8px;margin:5px;width:220px}
</style>
</head>

<body>

<header>üìò QU·∫¢N L√ù DANH S√ÅCH H·ªåC SINH L·ªöP 6</header>

<div class="container">

<h2>Danh s√°ch h·ªçc sinh</h2>

<table id="studentTable">
<tr>
    <th>STT</th>
    <th>H·ªç v√† t√™n</th>
    <th>Username</th>
    <th>Password</th>
    <th>Thao t√°c</th>
</tr>
</table>

<div class="box">
<h3>üì• Nh·∫≠p t·ª´ Excel (ch·ªâ c·∫ßn c·ªôt H·ªå T√äN)</h3>
<input type="file" id="excelFile" accept=".xls,.xlsx">
<button class="add-btn" onclick="importExcel()">Nh·∫≠p Excel</button>

<p><b>V√≠ d·ª• file Excel:</b></p>
<ul>
<li>STT | H·ªç v√† t√™n</li>
<li>H·ªç v√† t√™n</li>
</ul>
<p>üëâ Username t·ª± sinh | Password m·∫∑c ƒë·ªãnh: <b>123456</b></p>
</div>

<br>
<button class="back-btn" onclick="location.href='teacher_dashboard.html'">‚¨Ö Quay l·∫°i</button>

</div>

<script>
let students = JSON.parse(localStorage.getItem("students_grade6")) || [];

// =======================
// H√ÄM CHUY·ªÇN T√äN ‚Üí USERNAME
// =======================
function toUsername(str){
    return str.toLowerCase()
        .normalize("NFD").replace(/[\u0300-\u036f]/g,"")
        .replace(/ƒë/g,"d")
        .replace(/[^a-z\s]/g,"")
        .trim()
        .replace(/\s+/g,"_");
}

// =======================
function save(){
    localStorage.setItem("students_grade6",JSON.stringify(students));
}

function loadTable(){
    const table=document.getElementById("studentTable");
    table.innerHTML=`
    <tr>
        <th>STT</th>
        <th>H·ªç v√† t√™n</th>
        <th>Username</th>
        <th>Password</th>
        <th>Thao t√°c</th>
    </tr>`;
    students.forEach((s,i)=>{
        table.innerHTML+=`
        <tr>
            <td>${i+1}</td>
            <td>${s.fullname}</td>
            <td>${s.username}</td>
            <td>${s.password}</td>
            <td><button class="delete-btn" onclick="deleteStudent(${i})">X√≥a</button></td>
        </tr>`;
    });
}

// =======================
// IMPORT EXCEL (CH·ªà C·ªòT T√äN)
// =======================
function importExcel(){
    const file=document.getElementById("excelFile").files[0];
    if(!file){alert("‚ùå Ch∆∞a ch·ªçn file");return;}

    const reader=new FileReader();
    reader.onload=e=>{
        const wb=XLSX.read(new Uint8Array(e.target.result),{type:"array"});
        const sheet=wb.Sheets[wb.SheetNames[0]];
        const rows=XLSX.utils.sheet_to_json(sheet,{header:1});

        let added=0;
        for(let i=1;i<rows.length;i++){
            const r=rows[i];
            if(!r||!r[0]) continue;

            let fullname=r.length>=2 ? r[1] : r[0];
            if(!fullname) continue;

            const username=toUsername(fullname);
            if(students.some(s=>s.username===username)) continue;

            students.push({
                fullname:fullname.trim(),
                username,
                password:"123456"
            });
            added++;
        }

        save();
        loadTable();
        alert(`‚úÖ ƒê√£ nh·∫≠p ${added} h·ªçc sinh`);
        excelFile.value="";
    };
    reader.readAsArrayBuffer(file);
}

// =======================
function deleteStudent(i){
    if(confirm("X√≥a h·ªçc sinh n√†y?")){
        students.splice(i,1);
        save();
        loadTable();
    }
}

loadTable();
</script>

</body>
</html>