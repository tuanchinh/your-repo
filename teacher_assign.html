<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>üì§ Giao b√†i & H·ªçc li·ªáu</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
    font-family:Segoe UI, sans-serif;
    background:#eef3f7;
    margin:0;
}
.wrap{
    max-width:960px;
    margin:30px auto;
    background:#fff;
    padding:25px;
    border-radius:14px;
    box-shadow:0 6px 18px rgba(0,0,0,0.18);
}
h1{text-align:center;color:#0a4a8e}
label{font-weight:600;margin-top:12px;display:block}
select,input,textarea{
    width:100%;
    padding:10px;
    margin-top:6px;
    border:1px solid #c7d7e4;
    border-radius:8px;
    font-size:15px;
}
textarea{resize:vertical}
button{
    background:#0b74d1;
    color:#fff;
    padding:14px 22px;
    margin-top:20px;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-size:17px;
}
button:hover{background:#095ba8}
.back-btn{background:#888}
.back-btn:hover{background:#666}

.success{
    background:#e1fbd8;
    padding:12px;
    border-left:5px solid #4caf50;
    border-radius:8px;
    margin-top:20px;
}
.error{
    background:#ffe2e2;
    padding:12px;
    border-left:5px solid #e53935;
    border-radius:8px;
    margin-top:20px;
}
.section{
    margin-top:30px;
    padding-top:20px;
    border-top:2px dashed #d0dbe6;
}
</style>
</head>

<body>

<div class="wrap">

<button class="back-btn" onclick="window.location.href='teacher_dashboard.html'">‚Üê Quay l·∫°i</button>

<h1>üì§ GIAO B√ÄI & H·ªåC LI·ªÜU</h1>
<div id="msg"></div>

<!-- ================= GIAO B√ÄI KI·ªÇM TRA ================= -->
<div class="section">
<h2>üìù Giao b√†i ki·ªÉm tra</h2>

<label>Ch·ªçn l·ªõp:</label>
<select id="assignClass">
  <option value="6A">6A</option>
  <option value="6B">6B</option>
  <option value="7A1">7A1</option>
  <option value="7A2">7A2</option>
  <option value="8A">8A</option>
  <option value="9A">9A</option>
</select>

<label>Ch·ªçn ƒë·ªÅ ki·ªÉm tra:</label>
<select id="assignExam">
  <option>‚è≥ ƒêang t·∫£i ƒë·ªÅ...</option>
</select>

<label>H·∫°n n·ªôp:</label>
<input type="datetime-local" id="assignDeadline">

<button onclick="assignExam()">üì§ Giao b√†i</button>
</div>

<!-- ================= G·ª¨I H·ªåC LI·ªÜU ================= -->
<div class="section">
<h2>üìö G·ª≠i h·ªçc li·ªáu cho h·ªçc sinh</h2>

<label>L·ªõp nh·∫≠n h·ªçc li·ªáu:</label>
<select id="materialClass">
  <option value="6A">6A</option>
  <option value="6B">6B</option>
  <option value="7A1">7A1</option>
  <option value="7A2">7A2</option>
  <option value="8A">8A</option>
  <option value="9A">9A</option>
</select>

<label>Ti√™u ƒë·ªÅ h·ªçc li·ªáu:</label>
<input type="text" id="materialTitle" placeholder="V√≠ d·ª•: B√†i 7 ‚Äì Internet">

<label>Link h·ªçc li·ªáu (PDF / Video / Drive):</label>
<input type="text" id="materialLink" placeholder="https://...">

<label>Ghi ch√∫:</label>
<textarea id="materialNote" rows="3"></textarea>

<button onclick="sendMaterial()">üìò G·ª≠i h·ªçc li·ªáu</button>
</div>

</div>

<script>
// ================== CH·∫∂N TRUY C·∫¨P ==================
if(localStorage.getItem("role")!=="teacher"){
    alert("B·∫°n kh√¥ng c√≥ quy·ªÅn!");
    location.href="index.html";
}

// ================== LOAD ƒê·ªÄ ==================
async function loadExams(){
    const select=document.getElementById("assignExam");
    select.innerHTML="<option>‚è≥ ƒêang t·∫£i ƒë·ªÅ...</option>";

    try{
        const res=await fetch("./data/exams/index.json",{cache:"no-store"});
        const data=await res.json();

        select.innerHTML="<option value=''>-- Ch·ªçn ƒë·ªÅ --</option>";
        data.exams.forEach(e=>{
            const opt=document.createElement("option");
            opt.value=e.file;
            opt.textContent=`[L·ªõp ${e.grade}] ${e.title}`;
            select.appendChild(opt);
        });
    }catch{
        select.innerHTML="<option>‚ùå Kh√¥ng t·∫£i ƒë∆∞·ª£c ƒë·ªÅ</option>";
    }
}

// ================== GIAO B√ÄI ==================
function assignExam(){
    const cls=assignClass.value;
    const exam=assignExam.value;
    const deadline=assignDeadline.value;
    const msg=document.getElementById("msg");

    if(!exam||!deadline){
        msg.innerHTML="<div class='error'>‚ö†Ô∏è Thi·∫øu th√¥ng tin</div>";
        return;
    }

    const list=JSON.parse(localStorage.getItem("assigned_exams")||"[]");

    list.push({
        examFile: exam,
        className: cls,
        deadline,
        teacher: localStorage.getItem("username"),
        assignedAt: new Date().toLocaleString(),
        active: true
    });

    localStorage.setItem("assigned_exams",JSON.stringify(list));

    msg.innerHTML=`<div class='success'>‚úÖ ƒê√£ giao b√†i cho l·ªõp ${cls}</div>`;
    assignDeadline.value="";
}

// ================== G·ª¨I H·ªåC LI·ªÜU ==================
function sendMaterial(){
    const cls=materialClass.value;
    const title=materialTitle.value.trim();
    const link=materialLink.value.trim();
    const note=materialNote.value.trim();
    const msg=document.getElementById("msg");

    if(!title||!link){
        msg.innerHTML="<div class='error'>‚ö†Ô∏è Thi·∫øu ti√™u ƒë·ªÅ ho·∫∑c link</div>";
        return;
    }

    const materials=JSON.parse(localStorage.getItem("learning_materials")||"[]");

    materials.push({
        className: cls,
        title,
        link,
        note,
        teacher: localStorage.getItem("username"),
        sentAt: new Date().toLocaleString()
    });

    localStorage.setItem("learning_materials",JSON.stringify(materials));

    msg.innerHTML=`<div class='success'>üìò ƒê√£ g·ª≠i h·ªçc li·ªáu cho l·ªõp ${cls}</div>`;

    materialTitle.value="";
    materialLink.value="";
    materialNote.value="";
}

// ================== INIT ==================
loadExams();
</script>

</body>
</html>